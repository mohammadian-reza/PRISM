import os
from Bio.PDB import PDBParser

def distance_calculator(coordinates1, coordinates2):
    return ((float(coordinates1[0]) - float(coordinates2[0]))**2 + (float(coordinates1[1]) - float(coordinates2[1]))**2 + (float(coordinates1[2]) - float(coordinates2[2]))**2)**0.5

def read_ca_coordinates(path):
    parser = PDBParser(QUIET=True)
    ca_coordinates = []
    if not os.path.exists(path):
        return ca_coordinates
    structure = parser.get_structure("target", path)
    for model in structure:
        for chain in model:
            for residue in chain:
                if "CA" in residue:
                    ca_atom = residue["CA"]
                    coord = list(ca_atom.get_coord())
                    ca_coordinates.append(coord)
    return ca_coordinates

def three2one(res_name):
    return {
        'ALA':'A',
        'CYS':'C',
        'ASP':'D',
        'GLU':'E',
        'PHE':'F',
        'GLY':'G',
        'HIS':'H',
        'ILE':'I',
        'LYS':'K',
        'LEU':'L',
        'MET':'M',
        'ASN':'N',
        'PRO':'P',
        'GLN':'Q',
        'ARG':'R',
        'SER':'S',
        'THR':'T',
        'VAL':'V',
        'TRP':'W',
        'TYR':'Y'
    }.get(res_name, 'X')

def vdw_radii():
    return {'C':1.76, 'N':1.65, 'O':1.40, 'CA':1.87, 'H':1.20, 'S':1.85, 'CB':1.87, 'CZ':1.76, 'NZ':1.50, 'CD':1.81, 'CE':1.81, 'CG':1.81, 'C1':1.80, 'P':1.90}

def vdw_radii_extended(res_name):
    return {  
        'ALA': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'OXT': 1.40  },\
        'ARG': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.87, 'CD': 1.87, 'NE': 1.65, 'CZ': 1.76, 'NH1': 1.65, 'NH2': 1.65, 'OXT': 1.40 },\
        'ASP': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.76, 'OD1': 1.40, 'OD2': 1.40, 'OXT': 1.40  },\
        'ASN': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.76, 'OD1': 1.40, 'ND2': 1.65, 'OXT': 1.40 },\
        'CYS': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'SG': 1.85, 'OXT': 1.40 },\
        'GLU': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.87, 'CD': 1.76, 'OE1': 1.40, 'OE2': 1.40 , 'OXT': 1.40 },\
        'GLN': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.87, 'CD': 1.76, 'OE1': 1.40, 'NE2': 1.65, 'OXT': 1.40  },\
        'GLY': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'OXT': 1.40 },\
        'HIS': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.76, 'ND1': 1.65, 'CD2': 1.76, 'CE1': 1.76, 'NE2': 1.65, 'OXT': 1.40  },\
        'ILE': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG1': 1.87, 'CG2': 1.87, 'CD1': 1.87 , 'OXT': 1.40 },\
        'LEU': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.87, 'CD1': 1.87, 'CD2': 1.87, 'OXT': 1.40 },\
        'LYS': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.87, 'CD': 1.87, 'CE': 1.87, 'NZ': 1.50 , 'OXT': 1.40 },\
        'MET': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.87, 'SD': 1.85, 'CE': 1.87, 'OXT': 1.40 },\
        'PHE': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.76, 'CD1': 1.76, 'CD2': 1.76, 'CE1': 1.76, 'CE2': 1.76, 'CZ': 1.76, 'OXT': 1.40  },\
        'PRO': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.87, 'CD': 1.87, 'OXT': 1.40  },\
        'SER': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'OG': 1.40, 'OXT': 1.40 },\
        'THR': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'OG1': 1.40, 'CG2': 1.87, 'OXT': 1.40 },\
        'TRP': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.76, 'CD1': 1.76, 'CD2': 1.76, 'NE1': 1.65, 'CE2': 1.76, 'CE3': 1.76, 'CZ2': 1.76, 'CZ3': 1.76, 'CH2': 1.76, 'OXT': 1.40  },\
        'TYR': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.76, 'CD1': 1.76, 'CD2': 1.76, 'CE1': 1.76, 'CE2': 1.76, 'CZ': 1.76, 'OH': 1.40, 'OXT': 1.40 },\
        'VAL': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG1': 1.87, 'CG2': 1.87, 'OXT': 1.40  }, 'ASX': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.76, 'AD1': 1.50, 'AD2': 1.50 }, 'GLX': { 'N': 1.65, 'CA': 1.87, 'C': 1.76, 'O': 1.40, 'CB': 1.87, 'CG': 1.76, 'CD': 1.87, 'AE1': 1.50, 'AE2': 1.50, 'OXT': 1.40  },\
        'ACE': { 'C': 1.76, 'O': 1.40, 'CA': 1.87 },
        'PCA': vdw_radii(),
        'UNK': vdw_radii()
    }.get(res_name, vdw_radii())

PAIR_POTENTIAL = {
    'Q-Y': -4.75, 'Q-Q': -4.71, 'Q-S': -3.06, 'Q-R': -4.13, 'H-R': -3.24, 'Q-T': -3.44, 'Q-W': -4.87, 'Q-V': -4.29, 'C-F': -4.81, 'S-W': -2.86, 'E-E': -2.85, 'C-N': -1.76,
    'E-G': -1.58, 'C-L': -6.13, 'C-K': -2.28, 'C-I': -5.53, 'C-H': -4.79, 'C-G': -3.43, 'E-L': -4.35, 'C-E': -3.02, 'C-D': -3.56, 'E-I': -3.99, 'E-H': -3.15, 'E-K': -2.83,
    'E-T': -2.34, 'E-W': -3.84, 'E-V': -3.2, 'E-Q': -3.45, 'E-P': -1.7, 'C-Y': -4.71, 'E-R': -4.05, 'C-W': -4.7, 'C-V': -4.82, 'C-T': -2.92, 'C-S': -3.41, 'C-R': -4.41,
    'C-Q': -4.37, 'C-P': -2.97, 'M-Y': -5.01, 'H-Y': -3.78, 'H-T': -2.73, 'M-T': -3.33, 'H-V': -4.14, 'M-V': -5.16, 'M-Q': -4.46, 'M-P': -3.11, 'M-S': -3.33, 'M-R': -4.13,
    'H-L': -4.85, 'H-M': -4.47, 'H-N': -3.05, 'M-N': -3.05, 'H-H': -3.08, 'H-I': -4.55, 'H-K': -2.14, 'S-Y': -3.43, 'F-Y': -5.33, 'F-V': -5.33, 'S-V': -2.95, 'K-M': -2.36,
    'K-L': -3.24, 'F-R': -4.51, 'F-S': -4.01, 'F-P': -3.46, 'F-Q': -4.89, 'F-N': -3.89, 'K-V': -2.19, 'F-L': -6.65, 'F-M': -5.58, 'K-S': -1.91, 'F-K': -2.7, 'F-H': -3.82,
    'F-I': -6.11, 'F-F': -6.45, 'F-G': -3.76, 'F-T': -3.85, 'K-Y': -2.64, 'S-T': -2.22, 'N-W': -3.31, 'S-S': -2.14, 'V-Y': -4.54, 'V-V': -4.86, 'V-W': -4.7, 'K-W': -3.12,
    'K-T': -1.64, 'N-Y': -3.14, 'K-N': -1.63, 'K-R': -2.11, 'A-I': -4.45, 'A-H': -3.29, 'A-K': -1.91, 'A-M': -4.42, 'A-L': -5.02, 'A-N': -2.06, 'A-A': -3.51, 'A-C': -3.99, 
    'K-P': -0.5, 'A-E': -2.69, 'A-D': -2.74, 'A-G': -2.24, 'A-F': -4.43, 'A-Y': -3.96, 'E-F': -4.1, 'A-Q': -3.65, 'A-P': -1.78, 'A-S': -2.49, 'A-R': -3.26, 'A-T': -2.38, 
    'A-W': -4.66, 'A-V': -3.86, 'G-K': -1.32, 'G-I': -3.5, 'G-H': -2.47, 'G-N': -1.63, 'G-M': -3.02, 'G-L': -3.79, 'I-I': -5.97, 'I-K': -2.88, 'I-M': -5.37, 'I-L': -6.67, 
    'I-N': -3.42, 'I-Q': -4.65, 'I-P': -3.09, 'I-S': -3.47, 'I-R': -4.29, 'I-T': -3.61, 'I-W': -5.79, 'I-V': -5.31, 'I-Y': -5.39, 'G-R': -2.71, 'G-Q': -3.02, 'G-P': -1.01, 
    'C-M': -5.07, 'E-N': -2.43, 'C-C': -7.23, 'K-K': -1.02, 'P-P': -0.83, 'P-Q': -2.67, 'K-Q': -2.56, 'F-W': -5.72, 'D-M': -3.69, 'E-S': -2.57, 'W-Y': -5.12, 'Y-Y': -4.58,
    'E-Y': -3.62, 'W-W': -5.16, 'P-T': -1.24, 'R-S': -2.78, 'P-V': -2.43, 'P-W': -3.96, 'R-V': -3.7, 'R-W': -4.54, 'R-T': -2.43, 'P-S': -1.56, 'G-G': -1.77, 'R-Y': -4.32,
    'P-Y': -2.92, 'D-D': -2.47, 'D-E': -2.35, 'D-F': -3.52, 'D-G': -1.84, 'D-H': -2.93, 'D-I': -3.46, 'D-K': -2.47, 'D-L': -4.16, 'G-Y': -3.34, 'D-N': -2.5, 'D-P': -1.24,
    'D-Q': -3.15, 'D-R': -3.92, 'D-S': -2.34, 'D-T': -2.41, 'D-V': -3.28, 'D-W': -3.81, 'D-Y': -3.63, 'M-W': -5.49, 'N-V': -2.76, 'L-Y': -5.67, 'N-T': -2.05, 'H-W': -4.5,
    'N-R': -2.67, 'N-S': -2.13, 'N-P': -1.01, 'N-Q': -3.0, 'L-P': -3.75, 'L-Q': -5.36, 'L-R': -5.01, 'L-S': -4.12, 'L-T': -4.28, 'L-V': -6.03, 'L-W': -6.4, 'H-P': -1.8, 
    'G-S': -1.68, 'L-L': -7.16, 'L-M': -6.24, 'L-N': -3.94, 'E-M': -3.76, 'N-N': -1.99, 'H-S': -3.12, 'M-M': -5.89, 'T-T': -2.12, 'T-V': -2.87, 'T-W': -3.48, 'T-Y': -3.33,
    'G-W': -3.77, 'G-V': -2.77, 'G-T': -1.81, 'R-R': -3.98, 'H-Q': -4.2, 'P-R': -2.43
}

##dictionary of interested atoms which are sent by okeskin.
ATOM_DICT = {
    'ACE': ['CA'],
    'ALA': ['CB'],
    'GLY': ['CA'],
    'SER': ['OG'],
    'ASN': ['OD1', 'ND2'],
    'ASP': ['OD1', 'OD2'],
    'CYS': ['SG'],
    'PRO': ['CB', 'CG', 'CD'],
    'THR': ['OG1'],
    'VAL': ['CG1', 'CG2'],
    'ARG': ['NE', 'NH1', 'NH2'],
    'GLN': ['OE1', 'NE2'],
    'GLU': ['OE1', 'OE2'],
    'HIS': ['CG', 'ND1', 'CD2', 'CE1', 'NE2'],
    'ILE': ['CD1'],
    'LEU': ['CD1', 'CD2'],
    'LYS': ['NZ'],
    'MET': ['SD'],
    'PHE': ['CG', 'CD1', 'CD2', 'CE1', 'CE2', 'CZ'],
    'TRP': ['CD1', 'CD2', 'NE1', 'CE2', 'CE3', 'CZ2', 'CZ3', 'CH2'],
    'TYR': ['CG', 'CD1', 'CD2', 'CE1', 'CE2', 'CZ', 'OH']
}

def standard_data(resname):
    return {
        'ALA':107.95,
        'CYS':134.28,
        'ASP':140.39,
        'GLU':172.25,
        'PHE':199.48,
        'GLY':80.1,
        'HIS':182.88,
        'ILE':175.12,
        'LYS':200.81,
        'LEU':178.63,
        'MET':194.15,
        'ASN':143.94,
        'PRO':136.13,
        'GLN':178.5,
        'ARG':238.76,
        'SER':116.5,
        'THR':139.27,
        'VAL':151.44,
        'TRP':249.36,
        'TYR':212.76
    }.get(resname, -1)
    
STANDARD_AA = frozenset({
    "ALA", "ARG", "ASN", "ASP", "CYS", "GLN", "GLU", "GLY", "HIS", "ILE",
    "LEU", "LYS", "MET", "PHE", "PRO", "SER", "THR", "TRP", "TYR", "VAL",
})